# Signup機能テストケース一覧

## 概要

NicheHubのユーザーアカウント作成（Signup）機能に対するテストケース一覧。Playwrightを使用したE2Eテスト実装のための詳細仕様。

## テスト環境設定

### 前提条件
- テスト用のSupabaseプロジェクト環境
- テストデータベースの初期化
- テスト用メールアドレスドメインの設定

### テストデータ
```typescript
const TEST_DATA = {
  validEmail: "test@example.com",
  validPassword: "password123",
  validUsername: "testuser123",
  
  // 異常系テスト用
  existingEmail: "existing@example.com",
  existingUsername: "existinguser",
  invalidEmail: "invalid-email",
  shortPassword: "123",
  longUsername: "a".repeat(51) // 制限がある場合
};
```

## 1. 正常系テスト

### 1.1 基本的な新規登録フロー
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-001 | 有効なデータでの新規登録 | 1. Login画面にアクセス<br>2. 「登録」モードに切り替え<br>3. 有効なemail, password, confirm-password, usernameを入力<br>4. 登録ボタンをクリック | ・登録処理が成功<br>・ログインモードに切り替わる<br>・成功メッセージが表示される<br>・Supabaseにユーザーが作成される<br>・profilesテーブルにレコードが作成される |

### 1.2 フォーム操作
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-002 | ログインモードから登録モードへの切り替え | 1. Login画面にアクセス（デフォルトはログインモード）<br>2. 「新規登録」リンクをクリック | ・isLogin=falseに変更<br>・登録フォームが表示される<br>・username、confirm-passwordフィールドが表示される |
| SIGNUP-003 | 登録モードからログインモードへの切り替え | 1. 登録モードの状態<br>2. 「ログイン」リンクをクリック | ・isLogin=trueに変更<br>・ログインフォームが表示される<br>・username、confirm-passwordフィールドが非表示 |

### 1.3 入力フィールドの動作
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-004 | 各入力フィールドの基本動作 | 1. 登録モードに切り替え<br>2. 各フィールドに有効な値を入力 | ・emailフィールド: type="email"<br>・passwordフィールド: type="password"（マスク表示）<br>・confirm-passwordフィールド: type="password"<br>・usernameフィールド: type="text" |
| SIGNUP-005 | プレースホルダーの表示確認 | 1. 登録モードに切り替え | ・email: "your-email@example.com"<br>・password: "8文字以上のパスワード"<br>・confirm-password: "パスワードを再入力"<br>・username: "username123" |

## 2. バリデーションテスト（異常系）

### 2.1 必須入力チェック
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-101 | 全フィールド未入力での登録試行 | 1. 登録モードで全フィールドを空のまま<br>2. 登録ボタンをクリック | ・登録処理が実行されない<br>・必須入力エラーが表示される |
| SIGNUP-102 | emailのみ未入力 | 1. email以外のフィールドに有効な値を入力<br>2. 登録ボタンをクリック | ・メールアドレス必須エラーが表示される |
| SIGNUP-103 | passwordのみ未入力 | 1. password以外のフィールドに有効な値を入力<br>2. 登録ボタンをクリック | ・パスワード必須エラーが表示される |
| SIGNUP-104 | confirm-passwordのみ未入力 | 1. confirm-password以外のフィールドに有効な値を入力<br>2. 登録ボタンをクリック | ・パスワード確認必須エラーが表示される |
| SIGNUP-105 | usernameのみ未入力 | 1. username以外のフィールドに有効な値を入力<br>2. 登録ボタンをクリック | ・ユーザー名必須エラーが表示される |

### 2.2 フォーマットバリデーション
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-201 | 無効なメールアドレス形式 | 1. emailに"invalid-email"を入力<br>2. 他フィールドに有効値を入力<br>3. 登録ボタンをクリック | ・メールアドレス形式エラーが表示される<br>・HTML5バリデーションエラー |
| SIGNUP-202 | 短すぎるパスワード | 1. passwordに"123"（7文字以下）を入力<br>2. 他フィールドに有効値を入力<br>3. 登録ボタンをクリック | ・"パスワードは8文字以上で入力してください"エラーが表示される |
| SIGNUP-203 | パスワード不一致 | 1. passwordに"password123"を入力<br>2. confirm-passwordに"different123"を入力<br>3. 他フィールドに有効値を入力<br>4. 登録ボタンをクリック | ・"パスワードが一致しません"エラーが表示される |

### 2.3 特殊文字・境界値テスト
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-301 | ちょうど8文字のパスワード | 1. passwordに"abcd1234"（8文字）を入力<br>2. 他フィールドに有効値を入力<br>3. 登録ボタンをクリック | ・登録処理が成功する |
| SIGNUP-302 | 特殊文字を含むユーザー名 | 1. usernameに"user@#$"を入力<br>2. 他フィールドに有効値を入力<br>3. 登録ボタンをクリック | ・ユーザー名の文字制限に応じた処理<br>（許可/禁止のどちらかを確認） |
| SIGNUP-303 | 非常に長い入力値 | 1. 各フィールドに極端に長い文字列を入力<br>2. 登録ボタンをクリック | ・適切な文字数制限エラーが表示される |

## 3. バックエンドエラー処理テスト

### 3.1 重複チェック
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-401 | 既存メールアドレスでの登録試行 | 1. 既にDBに存在するメールアドレスを入力<br>2. 他フィールドに有効値を入力<br>3. 登録ボタンをクリック | ・"このメールアドレスは既に登録済みです"エラートーストが表示される<br>・error.message="User already registered" |
| SIGNUP-402 | 既存ユーザー名での登録試行 | 1. 既にDBに存在するユーザー名を入力<br>2. 他フィールドに有効値を入力<br>3. 登録ボタンをクリック | ・"このユーザー名は既に使用されています"エラートーストが表示される<br>・error.message="Username already exists" |

### 3.2 Supabaseエラー処理
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-501 | ネットワークエラー時の処理 | 1. ネットワークを切断した状態<br>2. 有効なデータで登録試行 | ・"ネットワークエラー"メッセージが表示される<br>・ローディング状態が解除される |
| SIGNUP-502 | Supabaseサービス停止時の処理 | 1. Supabaseが利用できない状態<br>2. 有効なデータで登録試行 | ・"サービス一時停止"メッセージが表示される<br>・適切なエラーハンドリング |

## 4. UI/UX動作テスト

### 4.1 ローディング状態
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-601 | 登録処理中のローディング表示 | 1. 有効なデータを入力<br>2. 登録ボタンをクリック<br>3. 処理完了まで待機 | ・isLoading=trueになる<br>・登録ボタンが無効化される<br>・ローディングインジケーターが表示される<br>・処理完了後にisLoading=falseになる |
| SIGNUP-602 | ローディング中の追加クリック防止 | 1. 有効なデータを入力<br>2. 登録ボタンをクリック<br>3. 処理中に再度ボタンをクリック | ・2回目のクリックが無視される<br>・重複処理が発生しない |

### 4.2 エラートースト表示
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-701 | エラートーストの表示確認 | 1. エラーが発生する操作を実行 | ・タイトル: "登録エラー"<br>・バリアント: "destructive"（赤色）<br>・エラー詳細メッセージが表示される<br>・一定時間後に自動消去される |
| SIGNUP-702 | 複数エラーの表示 | 1. 複数のエラーが発生する状況を作成 | ・最新のエラーが表示される<br>・適切にトーストが管理される |

### 4.3 フォーム状態管理
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-801 | 入力値の保持確認 | 1. 各フィールドに値を入力<br>2. ログイン⇔登録モードを切り替え | ・共通フィールド（email, password）の値が保持される<br>・登録固有フィールドは適切に表示/非表示される |
| SIGNUP-802 | フォームリセット | 1. エラー発生後の状態確認 | ・エラー発生後もフォーム値が保持される<br>・ユーザーが再入力しやすい状態 |

## 5. 統合テスト

### 5.1 完全フロー
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-901 | 新規登録→メール認証→コミュニティ選択フロー | 1. 新規ユーザーで登録完了<br>2. メール認証完了<br>3. CommunitySelection画面遷移 | ・各ステップが正常に動作<br>・データが正しくDBに保存される<br>・適切な画面遷移が行われる |
| SIGNUP-902 | 登録後の即座ログイン | 1. 新規登録完了<br>2. ログインモードに切り替わる<br>3. 同じ認証情報でログイン試行 | ・登録後すぐにログイン可能<br>・認証状態が正しく管理される |

### 5.2 データベース整合性
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-1001 | profiles テーブル作成確認 | 1. 新規登録完了<br>2. データベース状態確認 | ・Supabase Auth にユーザー作成<br>・profiles テーブルに対応レコード作成<br>・id = auth.user.id で連携<br>・username, display_name が正しく設定 |
| SIGNUP-1002 | 登録失敗時のデータ不整合防止 | 1. 認証は成功するがプロフィール作成で失敗<br>2. データベース状態確認 | ・適切なロールバック処理<br>・中途半端なデータが残らない |

## 6. セキュリティテスト

### 6.1 インジェクション攻撃対策
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-1101 | SQLインジェクション対策 | 1. usernameに"'; DROP TABLE profiles; --"を入力<br>2. 登録試行 | ・攻撃が無効化される<br>・正常なエラーハンドリング<br>・データベースに影響なし |
| SIGNUP-1102 | XSS攻撃対策 | 1. usernameに"<script>alert('xss')</script>"を入力<br>2. 登録試行 | ・スクリプトが実行されない<br>・適切にエスケープされる |

### 6.2 パスワードセキュリティ
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-1201 | パスワードハッシュ化確認 | 1. 新規登録完了<br>2. データベース確認 | ・平文パスワードが保存されていない<br>・Supabaseによる適切なハッシュ化 |

## 7. パフォーマンステスト

### 7.1 レスポンス時間
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-1301 | 登録処理の応答時間 | 1. 有効なデータで登録実行<br>2. 処理時間を測定 | ・5秒以内に処理完了<br>・ユーザビリティ基準を満たす |

## 8. ブラウザ互換性テスト

### 8.1 主要ブラウザでの動作確認
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-1401 | Chrome での動作確認 | 1. Chrome で全ての正常系テストを実行 | ・すべての機能が正常動作 |
| SIGNUP-1402 | Firefox での動作確認 | 1. Firefox で全ての正常系テストを実行 | ・すべての機能が正常動作 |
| SIGNUP-1403 | Safari での動作確認 | 1. Safari で全ての正常系テストを実行 | ・すべての機能が正常動作 |

## 9. モバイル対応テスト

### 9.1 レスポンシブデザイン
| テストケースID | テスト名 | 手順 | 期待結果 |
|---------------|---------|------|----------|
| SIGNUP-1501 | スマートフォン画面での操作 | 1. スマートフォン画面サイズで登録フロー実行 | ・UI要素が適切に表示される<br>・タップ操作が正常に動作 |
| SIGNUP-1502 | タブレット画面での操作 | 1. タブレット画面サイズで登録フロー実行 | ・UI要素が適切に表示される<br>・タッチ操作が正常に動作 |

## Playwright実装時の考慮点

### セレクター推奨事項
- `data-testid` 属性の使用を推奨
- フォームフィールドは `name` 属性も併用
- ボタンは `role` 属性も活用

### テストデータ管理
- 各テスト実行前にテストDBをクリーンアップ
- 独立したテストユーザーアカウントを使用
- 環境変数でテスト用設定を分離

### 非同期処理対応
- Supabase API 呼び出しの適切な待機
- ローディング状態の確認
- タイムアウト設定の調整

### エラー情報取得
- コンソールエラーの監視
- ネットワーク要求の検証
- レスポンス内容の確認 